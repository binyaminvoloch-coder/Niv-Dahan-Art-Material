<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Niv Dahan | אמן טדלקט מרוקאי בינלאומי</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;600;700;800&family=Rubik:wght@400;500;700&display=swap');
        :root { --tadelakt-ochre: #C2825A; --tadelakt-beige: #EADCD1; --light-bg: #fdfbf7; --text-dark: #2d2d2d; }
        body { font-family: 'Assistant', sans-serif; background-color: var(--light-bg); color: var(--text-dark); scroll-behavior: smooth; overflow-x: hidden; }
        .serif { font-family: 'Rubik', serif; }
        .text-gradient-tadelakt { background: linear-gradient(to right, var(--tadelakt-ochre), #9e6443); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .bg-gradient-tadelakt { background: linear-gradient(to right, var(--tadelakt-ochre), #9e6443); }

        .hero-section {
            background: linear-gradient(to bottom, rgba(255,255,255,0.1), rgba(253, 251, 247, 1)), url('01.webp');
            background-size: cover; background-position: center 5%; min-height: 100vh; background-attachment: fixed;
        }

        .img-straight { overflow: hidden; border-radius: 1.5rem; box-shadow: 0 10px 30px rgba(0,0,0,0.08); background-color: #eee; position: relative; }
        .img-straight img, .img-straight video { transition: transform 0.6s ease; width: 100%; height: 100%; object-fit: cover; }
        .img-straight:hover img { transform: scale(1.05); }

        /* אנימציית כניסה לתיקיות */
        .category-overlay { background: linear-gradient(to top, rgba(0,0,0,0.7), transparent); }
        
        #toast { position: fixed; bottom: 20px; right: 20px; transform: translateY(150%); transition: transform 0.3s; z-index: 3000; background: #333; color: white; padding: 1rem; border-radius: 1rem; border-right: 4px solid var(--tadelakt-ochre); }
        #toast.show { transform: translateY(0); }
        
        #category-modal { transition: opacity 0.3s ease; }
    </style>
</head>
<body>

    <div id="toast"><i data-lucide="info"></i> <span id="toast-msg"></span></div>

    <nav class="fixed top-0 w-full z-50 p-4">
        <div class="max-w-7xl mx-auto flex justify-between items-center bg-white/80 backdrop-blur-md rounded-full px-6 py-3 shadow-sm border border-white/50">
            <div class="text-xl font-bold serif uppercase text-gradient-tadelakt">Niv Dahan</div>
            <div class="flex gap-4">
                <a href="https://www.instagram.com/niv_d_tadelakt/" target="_blank"><i data-lucide="instagram" class="w-5 h-5 text-gray-600"></i></a>
                <a href="https://api.whatsapp.com/send/?phone=972535379988"><i data-lucide="message-circle" class="w-5 h-5 text-gray-600"></i></a>
            </div>
        </div>
    </nav>

    <header class="hero-section flex flex-col items-center justify-center text-center px-4">
        <h1 class="text-5xl md:text-8xl font-bold serif text-[#333] leading-none">Niv Dahan<br><span class="text-gradient-tadelakt">Art & Material</span></h1>
        <p class="text-lg md:text-2xl mt-6 text-gray-600 font-light italic">International Moroccan Tadelakt Artist</p>
        <a href="#contact-form" class="mt-8 bg-[#2d2d2d] text-white py-4 px-12 rounded-full font-bold shadow-xl hover:bg-tadelakt-ochre transition">יצירת קשר</a>
    </header>

    <main class="max-w-7xl mx-auto px-4 py-20 space-y-32">
        
        <!-- אודות (תמונת 02.webp מקומית) -->
        <section class="grid md:grid-cols-2 gap-12 items-center">
            <div class="img-straight h-[450px] md:h-[550px]">
                <img src="02.webp" alt="Niv Dahan">
            </div>
            <div class="text-right space-y-6">
                <h2 class="text-4xl font-bold serif">חיבור ל<span class="text-gradient-tadelakt">חומר</span></h2>
                <p class="text-lg text-gray-600 leading-relaxed">יוצר וחוקר אומנויות קישוט עתיקות מבוססות סיד. מומחה בשחזור ושימור מבנים בטיח מרוקאי (Tadelakt) בעבודת יד מסורתית.</p>
            </div>
        </section>

        <!-- פיגמנטים (03-05 מקומי) -->
        <section class="space-y-12">
            <h3 class="text-3xl font-bold text-center serif">הקסם של הפיגמנטים</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 h-auto md:h-[400px]">
                <div class="img-straight h-80 md:h-full cursor-pointer" onclick="openLightbox('03.webp')"><img src="03.webp"></div>
                <div class="img-straight h-80 md:h-full cursor-pointer md:-mt-10" onclick="openLightbox('04.webp')"><img src="04.webp"></div>
                <div class="img-straight h-80 md:h-full cursor-pointer" onclick="openLightbox('05.webp')"><img src="05.webp"></div>
            </div>
        </section>

        <!-- גלריית פרויקטים (קטגוריות) -->
        <section id="gallery-section" class="space-y-12">
            <div class="text-center">
                <h3 class="text-3xl font-bold serif mb-2">גלריית עבודות</h3>
                <p class="text-gray-400">לחצו על קטגוריה לצפייה בפרויקט המלא</p>
            </div>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-6" id="category-grid">
                <!-- קטגוריות ייטענו כאן -->
            </div>
        </section>

        <!-- טופס יצירת קשר -->
        <section id="contact-form" class="bg-white p-8 md:p-16 rounded-[2.5rem] shadow-sm border border-orange-50 max-w-4xl mx-auto">
            <h3 class="text-3xl font-bold serif text-center mb-8">בואו נדבר</h3>
            <form onsubmit="submitToGoogleSheets(event)" class="space-y-4">
                <div class="grid md:grid-cols-2 gap-4">
                    <input type="text" name="name" required placeholder="שם מלא" class="w-full p-4 rounded-xl bg-gray-50 border-none focus:ring-2 focus:ring-tadelakt-ochre">
                    <input type="tel" name="phone" required placeholder="טלפון" class="w-full p-4 rounded-xl bg-gray-50 border-none focus:ring-2 focus:ring-tadelakt-ochre">
                </div>
                <textarea name="message" rows="4" placeholder="איך אוכל לעזור?" class="w-full p-4 rounded-xl bg-gray-50 border-none focus:ring-2 focus:ring-tadelakt-ochre"></textarea>
                <button type="submit" id="submit-btn" class="w-full bg-gradient-tadelakt text-white font-bold py-4 rounded-xl">שלח הודעה</button>
            </form>
        </section>
    </main>

    <!-- מודל גלריית קטגוריה -->
    <div id="category-modal" class="fixed inset-0 z-[1000] hidden bg-white overflow-y-auto">
        <div class="sticky top-0 bg-white/90 backdrop-blur-md p-6 flex justify-between items-center border-b z-50">
            <h4 id="modal-title" class="text-2xl font-bold serif text-tadelakt-ochre"></h4>
            <button onclick="closeCategory()" class="p-3 bg-gray-100 rounded-full hover:bg-red-50 transition"><i data-lucide="x"></i></button>
        </div>
        <div class="max-w-7xl mx-auto p-6 grid grid-cols-2 md:grid-cols-3 gap-4" id="modal-grid"></div>
    </div>

    <!-- לייטבוקס לתמונה בודדת -->
    <div id="lightbox" class="fixed inset-0 bg-black/95 z-[2000] hidden flex items-center justify-center p-4" onclick="closeLightbox()">
        <button class="absolute top-5 right-5 text-white"><i data-lucide="x" class="w-10 h-10"></i></button>
        <div id="lightbox-content" class="max-w-full max-h-full" onclick="event.stopPropagation()"></div>
    </div>

    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyqbenjkSNnGq7hjh2GlYSazgkLd5HFj_kp79u7N1pwrR-choqD4GaNAt7G0lMoigKiaw/exec';
        let projectsData = [];

        async function loadData() {
            try {
                const res = await fetch(SCRIPT_URL);
                const data = await res.json();
                projectsData = data.projects || [];
                renderCategories();
            } catch (e) { console.error("Data error", e); }
        }

        function formatMediaUrl(url, isVid = false) {
            if (!url) return '01.webp';
            if (url.includes('id=')) {
                const id = url.split('id=')[1].split('&')[0];
                return isVid ? `https://drive.google.com/uc?id=${id}&export=download` : `https://drive.google.com/thumbnail?id=${id}&sz=w800-rw`;
            }
            if (url.includes('/d/')) {
                const id = url.split('/d/')[1].split('/')[0];
                return isVid ? `https://drive.google.com/uc?id=${id}&export=download` : `https://drive.google.com/thumbnail?id=${id}&sz=w800-rw`;
            }
            return url;
        }

        function renderCategories() {
            const grid = document.getElementById('category-grid');
            // קיבוץ לפי שם הפרויקט
            const categories = projectsData.reduce((acc, p) => {
                const cat = p.name || 'כללי';
                if (!acc[cat]) acc[cat] = [];
                acc[cat].push(p);
                return acc;
            }, {});

            grid.innerHTML = Object.keys(categories).map(catName => {
                const items = categories[catName];
                const coverImg = formatMediaUrl(items[0].url);
                return `
                    <div class="img-straight h-64 md:h-80 cursor-pointer group" onclick="openCategory('${catName}')">
                        <img src="${coverImg}" class="group-hover:scale-110">
                        <div class="category-overlay absolute inset-0 flex flex-col justify-end p-4 text-white">
                            <span class="text-xs uppercase tracking-widest opacity-70">${items.length} פריטים</span>
                            <h4 class="text-lg font-bold">${catName}</h4>
                        </div>
                    </div>
                `;
            }).join('');
            lucide.createIcons();
        }

        function openCategory(name) {
            const modal = document.getElementById('category-modal');
            const grid = document.getElementById('modal-grid');
            document.getElementById('modal-title').innerText = name;
            
            const filtered = projectsData.filter(p => (p.name || 'כללי') === name);
            
            grid.innerHTML = filtered.map(p => {
                const isVid = (p.description || '').includes('וידאו') || p.url.includes('.mp4');
                const thumb = formatMediaUrl(p.url, false);
                const full = formatMediaUrl(p.url, isVid);
                return `
                    <div class="img-straight h-48 md:h-72 cursor-pointer" onclick="openLightbox('${full}', ${isVid})">
                        <img src="${thumb}">
                        ${isVid ? '<div class="absolute inset-0 flex items-center justify-center"><i data-lucide="play" class="text-white w-12 h-12 opacity-80"></i></div>' : ''}
                    </div>
                `;
            }).join('');
            
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            lucide.createIcons();
        }

        function closeCategory() {
            document.getElementById('category-modal').classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        function openLightbox(src, isVid = false) {
            const lightbox = document.getElementById('lightbox');
            const content = document.getElementById('lightbox-content');
            content.innerHTML = isVid ? 
                `<video src="${src}" controls autoplay class="max-w-full max-h-[90vh] rounded-xl shadow-2xl"></video>` :
                `<img src="${src}" class="max-w-full max-h-[90vh] rounded-xl shadow-2xl">`;
            lightbox.classList.remove('hidden');
        }

        function closeLightbox() { document.getElementById('lightbox').classList.add('hidden'); }

        async function submitToGoogleSheets(e) {
            e.preventDefault();
            const btn = document.getElementById('submit-btn');
            btn.innerText = 'שולח...';
            try {
                await fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(Object.fromEntries(new FormData(e.target))) });
                showToast('הודעתך התקבלה בהצלחה!');
                e.target.reset();
            } catch (e) { showToast('שגיאה בשליחה.'); }
            btn.innerText = 'שלח הודעה';
        }

        function showToast(m) { const t = document.getElementById('toast'); document.getElementById('toast-msg').innerText = m; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'), 4000); }

        window.onload = () => { loadData(); lucide.createIcons(); };
    </script>
</body>
</html>
